<?php
	set_time_limit(0);
	ini_set('display_errors',1);
	error_reporting(E_ALL);

$connect = mysql_connect("192.168.100.121","curacaodata","curacaodata");
mysql_select_db("cdc",$connect);

	include('../urls.php');
	include('Mfunctions.php');
	// $fpl_id = $_GET['fpl_id'];
	$result = true;

	$updatenon = false;
	if($result == TRUE)
	{
	include(MAGE_FILE_URL);
	Varien_Profiler::enable();
	Mage::setIsDeveloperMode(true);
	$que = 1;
$j=0;
	umask(0);
	Mage::app('default'); 
        $currentStore = Mage::app()->getStore()->getId();
	Mage::app()->setCurrentStore(Mage_Core_Model_App::ADMIN_STORE_ID);


			$contents = mysql_query("SELECT * FROM `direct_mosse_products_missing_cat` WHERE `status`=3",$connect) or die(mysql_error($connect));

			while($content = mysql_fetch_object($contents))
			{

				echo $sku = trim($content->SKU);
        	$product_id = Mage::getModel('catalog/product')->getIdBySku(trim($sku));
			if($product_id)
			{
			// set URL key start
			$product = Mage::getModel('catalog/product');
			$product->load($product_id);
			
			$vendorid = trim($product->getvendorid());
			if($vendorid == '55676')
			{
			if($content->category_tree  != "")
			{
			$cat = $product->getCategoryIds();
			// check is this is contain more categories of not
			$findcat = explode('_',$content->category_tree);
			$catsize = sizeof($findcat);
			if($catsize > 1)
			{
			for($f=0;$f<$catsize;$f++)
			$cat[] = trim($findcat[$f]);
			$cat = array_values(array_unique($cat));
			$product->setCategoryIds($cat);
			}
			}
			}
			else
			{
				// 8 status product not in this vendor
			$contents = mysql_query("UPDATE direct_mosse_products_missing_cat SET `status`=8 WHERE `SKU`='$sku'");
			$updatenon = TRUE;
			}

					if($updatenon != TRUE)
					{	
					try {
					$product->save();
					// 6 status update successfully
					$contents = mysql_query("UPDATE direct_mosse_products_missing_cat SET `status`=6 WHERE `SKU`='$sku'");
					sleep(1);
$j=$j+1;
if($j == "50")
exit;
sleep(1);					
					} catch (Exception $ex) {
					echo $ex->getMessage();
					}
					}
			}
			else
			{
			echo $content->sku." Not Found<br>";
			}
			}
			echo "All Sku's Updated";
			}
?>